!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("dt-toolbox",[],t):"object"==typeof exports?exports["dt-toolbox"]=t():e["dt-toolbox"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";var n=void 0,u=void 0,o=void 0;n={notObject:function(e){var t=!1;return void 0===e&&(t=!0),"string"==typeof e&&(t=!0),"number"==typeof e&&(t=!0),"boolean"==typeof e&&(t=!0),"function"==typeof e&&(t=!0),t},isObject:function(e){return!n.notObject(e)},dt:function(){var e=Object.create(o),t=Object.create(u);return t.value=e,t.structure={root:"object"},t.namespace={root:[]},t._select=[],t._error=[],t},value:function(e){var t=Object.create(o);if(e){var r=Object.keys(e),n=r.map(function(e){return e.includes("root")?e:"root/"+e});t=r.reduce(function(r,u,o){return t[n[o]]=e[u],r},t)}return t},copy:function(e){return JSON.parse(JSON.stringify(e))},folderKind:function(e){return e instanceof Array?"array":"object"},getIterator:function(e){return Object.keys(e)},removeLast:function(e){var t=e.split("/");return t.pop(),t.join("/")},getPenult:function(e){var t=e.split("/");return t.pop(),t.pop()},getUlt:function(e){return e.split("/").pop()}};var i={init:function(e,t){var r=void 0;return r=void 0===e?n.dt():i.scan(e),t?c._transform(r,t):r},load:function(e){if(!e.namespace||!e.structure){e=n.value(e);var t=e.build();e=i.scan(t)}return e._select=[],e},loadFast:function(e){var t=n.dt();return t.value=e,t},scan:function(e){var t=n.dt();t.structure.root=n.folderKind(e),t.namespace.root=[];for(var r=[{target:e,namespace:"root",dt:t}],u=!1;!u;)r=r.reduce(function(e,t){var r=c._scan(t);return e=e.concat(r)},[]),0==r.length&&(u=!0);return t},preprocess:function(e,t){var r=i.scan(e),n=t(r.value);return i.scan(a.build.call(n))},add:function(e,t){var r=this,u=void 0,o=void 0,a=void 0;return u=i.scan(e),o=t?c._transform(u,t):u,a=n.getIterator(o.value),a.forEach(function(e){if(!r.value.hasOwnProperty(e)){var t=(o.value[e],n.getPenult(e)),u=n.removeLast(e),i=o.structure[u];r.value[e]=o.value[e],r.namespace.hasOwnProperty(t)||(r.namespace[t]=[]),r.namespace[t].push(e),r.structure.hasOwnProperty(u)||(r.structure[u]=i)}}),r},update:function(e,t){var r=this,u=void 0,o=void 0,a=void 0;return u=i.scan(e),o=t?c._transform(u,t):u,a=n.getIterator(o.value),a.forEach(function(e){if(r.value.hasOwnProperty(e)){var t=(o.value[e],n.getPenult(e),n.removeLast(e));o.structure[t],r.value[e]=o.value[e]}}),r},overwrite:function(e,t){var r=this,u=void 0,o=void 0,a=void 0;return u=i.scan(e),o=t?c._transform(u,t):u,a=n.getIterator(o.value),a.forEach(function(e){var t=r.value.hasOwnProperty(e);if(r.value[e]=o.value[e],!t){var u=n.getPenult(e),i=n.removeLast(e),a=o.structure[i];r.namespace.hasOwnProperty(u)||(r.namespace[u]=[]),r.namespace[u].push(e),r.structure.hasOwnProperty(i)||(r.structure[i]=a)}}),r},insert:function(e,t){var r=this,u=void 0,o=r.namespace[t],i=void 0;return n.notObject(e)&&(e=[e]),o?(u=n.value(e),i=u.valueList(),i.forEach(function(e){var n=o.length,u="root"==t?"root/"+n:"root/"+t+"/"+n;r.value[u]=e,r.namespace[t].push(u)}),r):(r._error.push('Insert error: Namespace "'+t+'" does not exists. Data failed to insert: '+JSON.stringify(e)),r)},identical:function(e,t){var r=this,u=this.value,o=n.getIterator(e),i=n.getIterator(u);return t(o.reduce(function(t,r){return i.includes(r)?u[r]!=e[r]?t:(t[r]=e[r],t):t},n.value())),r},change:function(e,t){var r=this,u=this.value,o=n.getIterator(u);return t(n.getIterator(e).reduce(function(t,r){return o.includes(r)?u[r]==e[r]?t:(t[r]=e[r],t):t},n.value())),r},same:function(e,t){var r=this,u=this.value,o=n.getIterator(e),i=n.getIterator(u);return t(o.reduce(function(t,r){return i.includes(r)?(t[r]=e[r],t):t},n.value())),r},different:function(e,t){var r=this,u=this.value,o=n.getIterator(u);return t(n.getIterator(e).reduce(function(t,r){return o.includes(r)?t:(t[r]=e[r],t)},n.value())),r},missing:function(e,t){var r=this,u=this.value,o=n.getIterator(u),i=n.getIterator(e);return t(o.reduce(function(e,t){return i.includes(t)?e:(e[t]=u[t],e)},n.value())),r},errorLog:function(e){return e(this._error),this},select:function(){return this._select=[],this},spread:function(e,t){var r=this,u=void 0;switch(e){case"value":case"values":u=r._select.reduce(function(e,t,n){return e["root/"+n]=r.value[t],e},n.value());break;case"st":var o=r._select.reduce(function(e,t){return e[t]=r.value[t],e},n.value());u=a.build(o);break;case"asJSON":var i=r._select.reduce(function(e,t){return e[t]=r.value[t],e},{});u=JSON.stringify(i);break;case"toJSON":var c=r._select.reduce(function(e,t){return e[t]=r.value[t],e},n.value());u=JSON.stringify(c.build());break;case"key":case"keys":u=r._select.reduce(function(e,t,r){return e["root/"+r]=t.replace("root/",""),e},n.value());break;case"dt":case"object":default:u=r._select.reduce(function(e,t){return e[t]=r.value[t],e},n.value())}return t(u),r},spreadAll:function(e,t){return this.select().all().spread(e,t)},invert:function(){var e=this,t=e._select,r=n.getIterator(e.value);return e._select=r.reduce(function(e,r){return t.includes(r)||e.push(r),e},[]),e},folder:function(e,t){var r=this,u=void 0;e=e||"root",t=isNaN(t)?9999:t,t+=1,u=e.split("/").length+t;var o=n.getIterator(r.value).filter(function(t){return t.match(e)}).reduce(function(e,t){return t.split("/").length<=u&&e.push(t),e},[]);return r._select=r._select.concat(o),r},parent:function(e,t){var r=this,u=void 0,o=void 0;o=r._select,r._select=[],r.folder(e);var i=r._select,a=i.reduce(function(e,t){var r=n.removeLast(t);return e.hasOwnProperty(r)?e:(e.push(r),e)},[]);return a=a.reduce(function(e,t){return e.every(function(e){return e!=t})&&e.push(t),e},[]),t&&(a=a.reduce(function(e,u){r._select=[],r.folder(u,0);var o=r._select,i=o.reduce(function(e,t){var u=n.getUlt(t),o=r.value[t];return e[u]=o,e},{});return t(i)&&e.push(u),e},[])),u=a.reduce(function(e,t){return r._select=[],r.folder(t),e.concat(r._select)},[]),r._select=o.concat(u),r},remove:function(e){var t=this;return void 0===e?t:(t._select=t._select.reduce(function(r,n){return e(t.value[n])||r.push(n),r},[]),t)},keep:function(e){var t=this;return void 0===e?t:(t._select=t._select.reduce(function(r,n){return e(t.value[n])&&r.push(n),r},[]),t)},limit:function(e){return this._select=this._select.slice(0,e),this},deep:function(e,t){var r=this,n=r._select.map(function(e){return e.split("/").length}),u=void 0;return t||(t="less"),"more"==t?(u=function(t){return n[t]>e},e+=1):(u=function(t){return n[t]<e},e+=3),r._select=r._select.reduce(function(e,t,r){return u(r)&&e.push(t),e},[]),this},space:function(e){var t=this,r=["root"];void 0===e&&(e=r),"string"==typeof e&&(e=[e]);var n=e.reduce(function(e,r){var n=t.namespace;return n.hasOwnProperty(r)&&(e=e.concat(n[r])),e},[]);return 0==!n.length&&(t._select=t._select.concat(n)),t},block:function(e){return function(){var t=this,r=t.structure,u=t.value,o=n.getIterator(r),i=n.getIterator(u),a=e||"object",s=[],l=c._reorder(o).reduce(function(e,t){var n=!1;return r[t]==a&&(n=e.every(function(e){return!e.includes(t)})),n&&e.push(t),e},[]);return s=i.reduce(function(e,t){var r=l.every(function(e){return!t.includes(e)}),n=!r;if(n){var u=!1;l.forEach(function(e){if(!u&&t.includes(e)){var r=e.split("/").length+1,o=t.split("/").length;n=o==r,u=!0}})}return n&&e.push(t),e},[]),0==!s.length&&(t._select=t._select.concat(s)),t}}},a={map:function(e){var t=this;return t.keyList().reduce(function(r,n,u){var o=e(n,u);return"string"!=typeof o&&(o=n),0!=o.indexOf("root/")&&(o="root/"+o),r[o]=t[n],r},n.value())},assemble:function(){var e=this,t=void 0,r=void 0;if(n.notObject(e))return!1;if(e instanceof Array)return!1;var u=n.getIterator(e);return 0==u.length?e:(t=u.map(function(e){return e.split("/")}).map(function(e){return e.shift(),e}),t=c._reorder(t),r=t.map(function(t){return e["root/"+t.join("/")]}),t=c._removeDuplicates(t),t=c._ignore(t),t.forEach(function(e){return e.unshift("root")}),t=t.map(function(e){return e.join("/")}),t.reduce(function(e,t,n){return e[t]=r[n],e},n.value()))},keyList:function(){return Object.getOwnPropertyNames(this)},valueList:function(){var e=this;return Object.getOwnPropertyNames(this).map(function(t){return e[t]})},ignoreKeys:function(e){var t=this,r=t.keyList(),u=(e||0)+1,o=[],i=n.value();return r.forEach(function(e){var r=e.split("/"),n=r[u];o.includes(n)||o.push(n),r[u]=o.length-1,i[r.join("/")]=t[e]}),i},cut:function(e){function t(e,r){var n=e.indexOf("/");return-1==n?r=0:r--,r<1?e.substring(n+1):t(e.substring(n+1),r)}var r=this,n=r.keyList();if("number"!=typeof e)return r;var u=n.map(function(r){return"root/"+t(r,e+1)});return r.modifyKeys(n,u)},modifyKeys:function(e,t){var r=this;return e.reduce(function(e,n,u){var o=r[n];return e[t[u]]=o,e},n.value())},keepKeys:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=Object.getOwnPropertyNames(t),r.reduce(function(r,n){var u=n.split("/");return e(u)&&(r[n]=t[n]),r},n.value()))},removeKeys:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=Object.getOwnPropertyNames(t),r.reduce(function(r,n){var u=n.split("/");return e(u)||(r[n]=t[n]),r},n.value()))},keepValues:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=t.keyList(),r.reduce(function(r,n){return e(t[n])&&(r[n]=t[n]),r},n.value()))},removeValues:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=t.keyList(),r.reduce(function(r,n){return e(t[n])||(r[n]=t[n]),r},n.value()))},json:function(e){return e||(e=this),JSON.stringify(e)},file:function(){var e=this;return e.keyList().reduce(function(t,r){var n=r.split("/"),u=n.reduce(function(e,t){return"root"==t?e:isNaN(parseInt(t))?e+"/"+t:e},"root");return t.push(u+"/"+e[r]),t},[])},keyValue:function(e){var t=this,r=e||"",n=(t.keyList(),t.keyList());return n.map(function(e,r){return e+" "+t[n[r]]}).join(r+" ")+r},list:function(){var e=this,t=n.getIterator(e),r=0,u=t.reduce(function(e,t){var u=n.removeLast(t);return void 0==e[u]&&(e[u]=r++),e},{}),o=n.getIterator(u);return t.reduce(function(t,r){var i=n.removeLast(r);if(o.includes(i)){var a=n.getUlt(r);t["root/"+u[i]+"/"+a]=e[r]}else t[r]=e[r];return t},n.value())},build:function(e){e||(e=this);var t=Object.getOwnPropertyNames(e),r=t.map(function(e){return e.split("/")});return c._build("root",r,e)}},c={_build:function(e,t,r){var u=void 0,o=n.copy(t);o=o.reduce(function(t,r){return r[0]==e&&(r.shift(),t.push(r)),t},[]),r=o.reduce(function(t,n){var u=n.join("/"),o=u;return 1==n.length?(o=o.slice(u.length+1),t[n[0]]=r[e+"/"+n[0]]):t[u]=r[e+"/"+u],t},{});var i=o.reduce(function(e,t){return!!isNaN(t[0])&&e},!0);if(u=i?{}:[],o.forEach(function(e){var t=e[0];1==e.length?u[t]=r[t]:u[t]=c._build(t,o,r)}),u instanceof Array){var a=n.getIterator(u);u=a.reduce(function(e,t){return"length"==t?e:(isNaN(t)?e[t]=u[t]:e.push(u[t]),e)},[])}return u},_toFolderFile:function(e){var t=[],r=[],u=0;return e.map(function(e){var n=e.split("/").pop(),u=e.replace("/"+n,"");t.forEach(function(e){u.includes(e)&&!r.includes(e)&&r.push(e)}),t.includes(u)?r.includes(u)||r.push(u):t.push(u)}),e.reduce(function(e,t){var n=t.split("/").pop(),o=t.replace("/"+n,"");return r.includes(o)?e[o+"/"+u++]=n:e[o]=n,e},n.value())},_scan:function(e){var t=e.target,r=e.namespace,u=e.dt;return n.getIterator(t).reduce(function(e,o){var i=n.notObject(t[o]),a=r+"/"+o;if(i){u.value[a]=t[o];var c=n.getUlt(r);return u.namespace[c].push(a),e}u.structure[a]=n.folderKind(t[o]),u.namespace.hasOwnProperty(o)||(u.namespace[o]=[]);var s={target:t[o],namespace:a,dt:u};return e.push(s),e},[])},_transform:function(e,t){var r=e.value,u=void 0;switch(t){case"reverse":u=r.keyList().reduce(function(t,r){return t[e.value[r]]=r,t},{});break;case"key":case"keys":var o=r.keyList(),s=o.reduce(function(e,t){return e[t]=t.replace("root/",""),e},{});u=a.build(s);break;case"value":case"values":var l=c._toFolderFile(r.valueList().map(function(e){return"root/"+e})),f=n.getIterator(l).reduce(function(e,t){return e[t+"/"+l[t]]=l[t],e},{});u=a.build(f);break;case"file":case"files":case"folders":case"folder":u=c._toFolderFile(r.valueList().map(function(e){return"root/"+e})).build();break;default:u=r}return e=i.scan(u)},_validate:function(e){var t=void 0,r=e.reduce(function(e,t){for(var r=t.split("/");r.length>2;){r.pop(),t=r.join("/");e.every(function(e){return e!=t})&&e.push(t)}return e},[]);return e.map(function(e){t=!1;for(var n in r)r[n]==e&&(t=!0);return!t&&e})},_removeDuplicates:function e(t){var r=void 0,n=void 0,u=void 0;return 1==t[0].length?t:(r=t.map(function(e){return e[0]}),n=r[0],u=void 0!=n&&r.every(function(e){return e==n}),u&&(t.forEach(function(e){return e.shift()}),e(t)),t)},_reorder:function(e,t){var r=[];t=t||0;var n=e.reduce(function(e,t){return t.length>e?t.length:e},0);return t>n?e:(e.reduce(function(e,r){return r.length-1==t?e:r[t]?(e.every(function(e){return e!=r[t]})&&e.push(r[t]),e):e},[]).forEach(function(n){e.forEach(function(e){e[t]==n&&r.push(e)})}),e.forEach(function(e){r.every(function(t){return t!=e})&&r.push(e)}),t++,c._reorder(r,t))},_ignore:function(e){var t=void 0,r=void 0,u=void 0,o=0;return e=n.copy(e),r=e.map(function(e){return e.pop()}),t=e.map(function(e){if(0==e.length)return e;var t=e.join("");return isNaN(t)?[e.join("_")]:[e.join("")]}),t=t.map(function(e,t){return e.concat(r[t])}),u=t[0][0],t=t.map(function(e){return e[0]!=u&&(u=e[0],o++),isNaN(e[0])||(e[0]=o),e})}};o={assemble:a.assemble,ignoreKeys:a.ignoreKeys,cut:a.cut,keyList:a.keyList,valueList:a.valueList,list:a.list,map:a.map,json:a.json,file:a.file,keyValue:a.keyValue,build:a.build,modifyKeys:a.modifyKeys,keepKeys:a.keepKeys,removeKeys:a.removeKeys,keepValues:a.keepValues,removeValues:a.removeValues},u={init:i.init,load:i.load,loadFast:i.loadFast,preprocess:i.preprocess,add:i.add,update:i.update,insert:i.insert,overwrite:i.overwrite,spread:i.spread,spreadAll:i.spreadAll,log:i.errorLog,empty:function(){return Object.create(o)},identical:i.identical,change:i.change,same:i.same,different:i.different,missing:i.missing,select:i.select,parent:i.parent,folder:i.folder,all:i.folder,space:i.space,deepArray:i.block("array"),deepObject:i.block("object"),invert:i.invert,limit:i.limit,keep:i.keep,remove:i.remove,deep:i.deep},e.exports=u}])});