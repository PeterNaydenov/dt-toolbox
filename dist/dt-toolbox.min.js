!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("dtbox",[],t):"object"==typeof exports?exports.dtbox=t():e.dtbox=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";function n(){var e=Object.create(c),t=Object.create(i);return t.value=e,t.structure={root:"object"},t.namespace={root:[]},t._select=[],t._error=[],t}function u(e){var t=Object.create(c);if(e){var r=Object.keys(e),n=r.map(function(e){return e.includes("root")?e:"root/"+e});t=r.reduce(function(r,u,o){return t[n[o]]=e[u],r},t)}return t}var o=r(1),i=void 0,c=void 0,a={init:function(e,t){var r=void 0;return r=void 0===e?n():a.scan(e),t?f._transform(r,t):r},load:function(e){if(!e.namespace||!e.structure){e=u(e);var t=e.build();e=a.scan(t)}return e._select=[],e},loadFast:function(e){var t=n();return t.value=e,t},scan:function(e){var t=n();t.structure.root=o.folderKind(e),t.namespace.root=[];for(var r=[{target:e,namespace:"root",dt:t}],u=!1;!u;)r=r.reduce(function(e,t){var r=f._scan(t);return e=e.concat(r)},[]),0==r.length&&(u=!0);return t},preprocess:function(e,t){var r=a.scan(e),n=t(r.value);return a.scan(s.build.call(n))},add:function(e,t){var r=this,n=void 0,u=void 0,i=void 0;return n=a.scan(e),u=t?f._transform(n,t):n,i=o.getIterator(u.value),i.forEach(function(e){if(!r.value.hasOwnProperty(e)){var t=(u.value[e],o.getPenult(e)),n=o.removeLast(e),i=u.structure[n];r.value[e]=u.value[e],r.namespace.hasOwnProperty(t)||(r.namespace[t]=[]),r.namespace[t].push(e),r.structure.hasOwnProperty(n)||(r.structure[n]=i)}}),r},update:function(e,t){var r=this,n=void 0,u=void 0,i=void 0;return n=a.scan(e),u=t?f._transform(n,t):n,i=o.getIterator(u.value),i.forEach(function(e){if(r.value.hasOwnProperty(e)){var t=(u.value[e],o.getPenult(e),o.removeLast(e));u.structure[t],r.value[e]=u.value[e]}}),r},overwrite:function(e,t){var r=this,n=void 0,u=void 0,i=void 0;return n=a.scan(e),u=t?f._transform(n,t):n,i=o.getIterator(u.value),i.forEach(function(e){var t=r.value.hasOwnProperty(e);if(r.value[e]=u.value[e],!t){var n=o.getPenult(e),i=o.removeLast(e),c=u.structure[i];r.namespace.hasOwnProperty(n)||(r.namespace[n]=[]),r.namespace[n].push(e),r.structure.hasOwnProperty(i)||(r.structure[i]=c)}}),r},insert:function(e,t){var r=this,n=void 0,i=r.namespace[t],c=void 0;return o.notObject(e)&&(e=[e]),i?(n=u(e),c=n.valueList(),c.forEach(function(e){var n=i.length,u="root"==t?"root/"+n:"root/"+t+"/"+n;r.value[u]=e,r.namespace[t].push(u)}),r):(r._error.push('Insert error: Namespace "'+t+'" does not exists. Data failed to insert: '+JSON.stringify(e)),r)},identical:function(e,t){var r=this,n=this.value,i=o.getIterator(e),c=o.getIterator(n);return t(i.reduce(function(t,r){return c.includes(r)?n[r]!=e[r]?t:(t[r]=e[r],t):t},u())),r},change:function(e,t){var r=this,n=this.value,i=o.getIterator(n);return t(o.getIterator(e).reduce(function(t,r){return i.includes(r)?n[r]==e[r]?t:(t[r]=e[r],t):t},u())),r},same:function(e,t){var r=this,n=this.value,i=o.getIterator(e),c=o.getIterator(n);return t(i.reduce(function(t,r){return c.includes(r)?(t[r]=e[r],t):t},u())),r},different:function(e,t){var r=this,n=this.value,i=o.getIterator(n);return t(o.getIterator(e).reduce(function(t,r){return i.includes(r)?t:(t[r]=e[r],t)},u())),r},missing:function(e,t){var r=this,n=this.value,i=o.getIterator(n),c=o.getIterator(e);return t(i.reduce(function(e,t){return c.includes(t)?e:(e[t]=n[t],e)},u())),r},errorLog:function(e){return e(this._error),this},select:function(){return this._select=[],this},spread:function(e,t){var r=this,n=void 0;switch(e){case"value":case"values":n=r._select.reduce(function(e,t,n){return e["root/"+n]=r.value[t],e},u());break;case"st":var o=r._select.reduce(function(e,t){return e[t]=r.value[t],e},u());n=s.build(o);break;case"asJSON":var i=r._select.reduce(function(e,t){return e[t]=r.value[t],e},{});n=JSON.stringify(i);break;case"toJSON":var c=r._select.reduce(function(e,t){return e[t]=r.value[t],e},u());n=JSON.stringify(c.build());break;case"key":case"keys":n=r._select.reduce(function(e,t,r){return e["root/"+r]=t.replace("root/",""),e},u());break;case"dt":case"object":default:n=r._select.reduce(function(e,t){return e[t]=r.value[t],e},u())}return t(n),r},spreadAll:function(e,t){return this.select().all().spread(e,t)},invert:function(){var e=this,t=e._select,r=o.getIterator(e.value);return e._select=r.reduce(function(e,r){return t.includes(r)||e.push(r),e},[]),e},folder:function(e,t){var r=this,n=void 0;e=e||"root",t=null==t?9999:t,t+=1,n=e.split("/").length+t;var u=o.getIterator(r.value).filter(function(t){return t.match(e)}).reduce(function(e,t){return t.split("/").length<=n&&e.push(t),e},[]);return r._select=r._select.concat(u),r},parent:function(e,t){var r=this,n=void 0,u=void 0;u=r._select,r._select=[],r.folder(e);var i=r._select,c=i.reduce(function(e,t){var r=o.removeLast(t);return e.includes(r)?e:(e.push(r),e)},[]);return t&&(c=c.reduce(function(e,n){r._select=[],r.folder(n,0);var u=r._select,i=u.reduce(function(e,t){var n=o.getUlt(t),u=r.value[t];return e[n]=u,e},{});return t(i)&&e.push(n),e},[])),n=c.reduce(function(e,t){return r._select=[],r.folder(t),e.concat(r._select)},[]),r._select=u.concat(n),r},remove:function(e){var t=this;return void 0===e?t:(t._select=t._select.reduce(function(r,n){return e(t.value[n],n)||r.push(n),r},[]),t)},keep:function(e){var t=this;return void 0===e?t:(t._select=t._select.reduce(function(r,n){return e(t.value[n],n)&&r.push(n),r},[]),t)},limit:function(e){return this._select=this._select.slice(0,e),this},deep:function(e,t){var r=this,n=r._select.map(function(e){return e.split("/").length}),u=void 0;return t||(t="less"),"more"==t?(u=function(t){return n[t]>e},e+=1):(u=function(t){return n[t]<e},e+=3),r._select=r._select.reduce(function(e,t,r){return u(r)&&e.push(t),e},[]),this},space:function(e){var t=this,r=["root"];null==e&&(e=r),"string"==typeof e&&(e=[e]);var n=e.reduce(function(e,r){var n=t.namespace;return n.hasOwnProperty(r)&&(e=e.concat(n[r])),e},[]);return 0==!n.length&&(t._select=t._select.concat(n)),t},block:function(e){return function(){var t=this,r=t.structure,n=t.value,u=o.getIterator(r),i=o.getIterator(n),c=e,a=[],s=f._reorder(u).reduce(function(e,t){var n=!1;return r[t]==c&&(n=e.every(function(e){return!e.includes(t)})),n&&e.push(t),e},[]);return a=i.reduce(function(e,t){var r=s.every(function(e){return!t.includes(e)}),n=!r;if(n){var u=!1;s.forEach(function(e){if(!u&&t.includes(e)){var r=e.split("/").length+1,o=t.split("/").length;n=o==r,u=!0}})}return n&&e.push(t),e},[]),0==!a.length&&(t._select=t._select.concat(a)),t}}},s={map:function(e){var t=this;return t.keyList().reduce(function(r,n,u){var o=e(n,u);return"string"!=typeof o&&(o=n),0!=o.indexOf("root/")&&(o="root/"+o),r[o]=t[n],r},u())},assemble:function(){var e=this,t=void 0,r=void 0,n=o.getIterator(e);return 0==n.length?e:(t=n.map(function(e){return e.split("/")}).map(function(e){return e.shift(),e}),t=f._reorder(t),r=t.map(function(t){return e["root/"+t.join("/")]}),t=f._removeDuplicates(t),t=f._ignore(t),t.forEach(function(e){return e.unshift("root")}),t=t.map(function(e){return e.join("/")}),t.reduce(function(e,t,n){return e[t]=r[n],e},u()))},keyList:function(){return Object.getOwnPropertyNames(this)},valueList:function(){var e=this;return Object.getOwnPropertyNames(this).map(function(t){return e[t]})},ignoreKeys:function(e){var t=this,r=t.keyList(),n=(e||0)+1,o=[],i=u();return r.forEach(function(e){var r=e.split("/"),u=r[n];o.includes(u)||o.push(u),r[n]=o.length-1,i[r.join("/")]=t[e]}),i},cut:function(e){function t(e,r){var n=e.indexOf("/");return-1==n?r=0:r--,r<1?e.substring(n+1):t(e.substring(n+1),r)}var r=this;return"number"!=typeof e?r:r.modifyKeys(function(r){return"root/"+t(r,e+1)})},modifyKeys:function(e){var t=this;return o.getIterator(t).reduce(function(r,n,u){var o=t[n];return r[e(n)]=o,r},u())},keepKeys:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=Object.getOwnPropertyNames(t),r.reduce(function(r,n){var u=n.split("/");return e(u)&&(r[n]=t[n]),r},u()))},removeKeys:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=Object.getOwnPropertyNames(t),r.reduce(function(r,n){var u=n.split("/");return e(u)||(r[n]=t[n]),r},u()))},keepValues:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=t.keyList(),r.reduce(function(r,n){return e(t[n])&&(r[n]=t[n]),r},u()))},removeValues:function(e){var t=this,r=void 0;return"function"!=typeof e?t:(r=t.keyList(),r.reduce(function(r,n){return e(t[n])||(r[n]=t[n]),r},u()))},json:function(){return JSON.stringify(this)},file:function(){var e=this;return e.keyList().reduce(function(t,r){var n=r.split("/"),u=n.reduce(function(e,t){return"root"==t?e:isNaN(parseInt(t))?e+"/"+t:e},"root");return t.push(u+"/"+e[r]),t},[])},keyValue:function(e){var t=this,r=e||"",n=(t.keyList(),t.keyList());return n.map(function(e,r){return e+" "+t[n[r]]}).join(r+" ")+r},list:function(){var e=this,t=o.getIterator(e),r=0,n=t.reduce(function(e,t){var n=o.removeLast(t);return void 0==e[n]&&(e[n]=r++),e},{});return t.reduce(function(t,r){var u=o.removeLast(r),i=o.getUlt(r);return t["root/"+n[u]+"/"+i]=e[r],t},u())},build:function(e){return e||(e=this),f._build(e)}},f={_build:function(e){var t=Object.keys(e).map(function(e){return e.split("/")}),r={},n=[],u=[];return t.forEach(function(e){var t=e[0];1!=e.length&&(n.includes(t)||n.push(t))}),t.forEach(function(e){u.includes(e[0])||u.push(e[0])}),!isNaN(u[0])&&(r=[]),n.forEach(function(n){var u=[],o=t.reduce(function(e,t){return t[0]!=n?e:(e.includes(t[1])||e.push(t[1]),e)},[]);o.every(function(e){var t=parseInt(e);isNaN(t)&&(u={})}),r=o.reduce(function(r,u){var o=n+"/"+u,i=e[o],c=t.reduce(function(t,r){return 2==r.length?t:r.join("/").includes(o)?(t[r.slice(1).join("/")]=e[r.join("/")],t):t},{});return r[u]=i||f._build(c),r},u)}),r},_toFolderFile:function(e){var t=[],r=[],n=[];return e.forEach(function(e){var u=e.split("/").pop(),o=e.replace("/"+u,"");t.forEach(function(e){o.includes(e)&&!r.includes(e)&&(r.push(e),n.push(0))}),t.includes(o)||t.push(o)}),e.reduce(function(e,t){var u=t.split("/").pop(),o=t.replace("/"+u,""),i=r.findIndex(function(e){return e==o});return i>-1?e[o+"/"+n[i]++]=u:e[o]=u,e},u())},_scan:function(e){var t=e.target,r=e.namespace,n=e.dt;return o.getIterator(t).reduce(function(e,u){var i=o.notObject(t[u]),c=r+"/"+u;if(i){n.value[c]=t[u];var a=o.getUlt(r);return n.namespace[a].push(c),e}n.structure[c]=o.folderKind(t[u]),n.namespace.hasOwnProperty(u)||(n.namespace[u]=[]);var s={target:t[u],namespace:c,dt:n};return e.push(s),e},[])},_transform:function(e,t){var r=e.value,n=void 0;switch(t){case"reverse":n=r.keyList().reduce(function(t,r){return t[e.value[r]]=r,t},{});break;case"key":case"keys":var u=r.keyList(),i=u.reduce(function(e,t){return e[t]=t.replace("root/",""),e},{});n=s.build(i);break;case"value":case"values":var c=f._toFolderFile(r.valueList().map(function(e){return"root/"+e})),l=o.getIterator(c).reduce(function(e,t){var r=c[t];return e[isNaN(parseInt(r))?t+"/"+r:t+"/0"]=r,e},{});n=s.build(l);break;case"file":case"files":case"folders":case"folder":n=f._toFolderFile(r.valueList().map(function(e){return"root/"+e})).build();break;default:n={}}return e=a.scan(n)},_removeDuplicates:function(e){var t=void 0,r=void 0,n=void 0;return 1==e[0].length?e:(t=e.map(function(e){return e[0]}),r=t[0],n=t.every(function(e){return e==r}),n&&(e.forEach(function(e){return e.shift()}),f._removeDuplicates(e)),e)},_reorder:function(e,t){var r=[];t=t||0;var n=e.reduce(function(e,t){return t.length>e?t.length:e},0);return t>n?e:(e.reduce(function(e,r){return r.length-1==t?e:r[t]?(e.every(function(e){return e!=r[t]})&&e.push(r[t]),e):e},[]).forEach(function(n){e.forEach(function(e){e[t]==n&&r.push(e)})}),e.forEach(function(e){r.every(function(t){return t!=e})&&r.push(e)}),t++,f._reorder(r,t))},_ignore:function(e){var t=void 0,r=void 0,n=void 0,u=0;return e=o.copy(e),r=e.map(function(e){return e.pop()}),t=e.map(function(e){if(0==e.length)return e;var t=e.join("");return isNaN(t)?[e.join("_")]:[e.join("")]}),t=t.map(function(e,t){return e.concat(r[t])}),n=t[0][0],t=t.map(function(e){return e[0]!=n&&(n=e[0],u++),isNaN(e[0])||(e[0]=u),e})}};c={assemble:s.assemble,ignoreKeys:s.ignoreKeys,cut:s.cut,keyList:s.keyList,valueList:s.valueList,list:s.list,map:s.map,json:s.json,file:s.file,keyValue:s.keyValue,build:s.build,modifyKeys:s.modifyKeys,keepKeys:s.keepKeys,removeKeys:s.removeKeys,keepValues:s.keepValues,removeValues:s.removeValues},i={init:a.init,load:a.load,loadFast:a.loadFast,preprocess:a.preprocess,add:a.add,update:a.update,insert:a.insert,overwrite:a.overwrite,spread:a.spread,spreadAll:a.spreadAll,log:a.errorLog,empty:function(){return Object.create(c)},identical:a.identical,change:a.change,same:a.same,different:a.different,missing:a.missing,select:a.select,parent:a.parent,folder:a.folder,all:a.folder,space:a.space,deepArray:a.block("array"),deepObject:a.block("object"),invert:a.invert,limit:a.limit,keep:a.keep,remove:a.remove,deep:a.deep},e.exports=i},function(e,t,r){"use strict";var n={notObject:function(e){var t=!1;return null==e&&(t=!0),"string"==typeof e&&(t=!0),"number"==typeof e&&(t=!0),"boolean"==typeof e&&(t=!0),"function"==typeof e&&(t=!0),t},isObject:function(e){return!n.notObject(e)},copy:function(e){return JSON.parse(JSON.stringify(e))},folderKind:function(e){return e instanceof Array?"array":"object"},getIterator:function(e){return Object.keys(e)},removeLast:function(e){var t=e.split("/");return t.pop(),t.join("/")},getPenult:function(e){var t=e.split("/");return t.pop(),t.pop()},getUlt:function(e){return e.split("/").pop()}};e.exports=n}])});