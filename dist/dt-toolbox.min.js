!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("dtbox",[],t):"object"==typeof exports?exports.dtbox=t():e.dtbox=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var u=t[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,r),u.l=!0,u.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var u in e)r.d(n,u,function(t){return e[t]}.bind(null,u));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n,u,c=r(1);function o(){var e=Object.create(u),t=Object.create(n);return t.value=e,t.structure={root:"object"},t.namespace={root:[]},t._select=[],t._error=[],t}function a(e){var t=Object.create(u);if(e){var r=Object.keys(e),n=r.map((function(e){return e.includes("root")?e:"root/".concat(e)}));t=r.reduce((function(r,u,c){return t[n[c]]=e[u],r}),t)}return t}var i={init:function(e,t){var r;return r=void 0===e?o():i.scan(e),t?f._transform(r,t):r},load:function(e){if(!e.namespace||!e.structure){var t=(e=a(e)).build();e=i.scan(t)}return e._select=[],e},loadFast:function(e){var t=o();return t.value=e,t},scan:function(e){var t=o();t.structure.root=c.folderKind(e),t.namespace.root=[];for(var r=[{target:e,namespace:"root",dt:t}],n=!1;!n;)0==(r=r.reduce((function(e,t){var r=f._scan(t);return e=e.concat(r)}),[])).length&&(n=!0);return t},preprocess:function(e,t){var r=t(i.scan(e).value);return i.scan(s.build.call(r))},add:function(e,t){var r,n,u=this;return r=i._detectDT(e),n=t?f._transform(r,t):r,c.getIterator(n.value).forEach((function(e){if(!u.value.hasOwnProperty(e)){n.value[e];var t=c.getPenult(e),r=c.removeLast(e),o=n.structure[r];u.value[e]=n.value[e],u.namespace.hasOwnProperty(t)||(u.namespace[t]=[]),u.namespace[t].push(e),u.structure.hasOwnProperty(r)||(u.structure[r]=o)}})),u},_detectDT:function(e){var t=e.value&&e.structure&&e._error,r=!!t||Object.keys(e)[0].includes("root");return t?e:r?i.load(e):i.scan(e)},update:function(e,t){var r,n,u=this;return r=i._detectDT(e),n=t?f._transform(r,t):r,c.getIterator(n.value).forEach((function(e){if(u.value.hasOwnProperty(e)){n.value[e],c.getPenult(e);var t=c.removeLast(e);n.structure[t];u.value[e]=n.value[e]}})),u},overwrite:function(e,t){var r,n,u=this;return r=i._detectDT(e),n=t?f._transform(r,t):r,c.getIterator(n.value).forEach((function(e){var t=u.value.hasOwnProperty(e);if(u.value[e]=n.value[e],!t){var r=c.getPenult(e),o=c.removeLast(e),a=n.structure[o];u.namespace.hasOwnProperty(r)||(u.namespace[r]=[]),u.namespace[r].push(e),u.structure.hasOwnProperty(o)||(u.structure[o]=a)}})),u},insert:function(e,t){var r=this,n=r.namespace[t];return c.notObject(e)&&(e=[e]),n?(a(e).valueList().forEach((function(e){var u=n.length,c="root"==t?"root/".concat(u):"root/".concat(t,"/").concat(u);r.value[c]=e,r.namespace[t].push(c)})),r):(r._error.push('Insert error: Namespace "'.concat(t,'" does not exists. Data failed to insert: ').concat(JSON.stringify(e))),r)},identical:function(e,t){var r=this.value,n=c.getIterator(e),u=c.getIterator(r);return t(n.reduce((function(t,n){return u.includes(n)?(r[n]!=e[n]||(t[n]=e[n]),t):t}),a())),this},change:function(e,t){var r=this.value,n=c.getIterator(r);return t(c.getIterator(e).reduce((function(t,u){return n.includes(u)?(r[u]==e[u]||(t[u]=e[u]),t):t}),a())),this},same:function(e,t){var r=this.value,n=c.getIterator(e),u=c.getIterator(r);return t(n.reduce((function(t,r){return u.includes(r)?(t[r]=e[r],t):t}),a())),this},different:function(e,t){var r=this.value,n=c.getIterator(r);return t(c.getIterator(e).reduce((function(t,r){return n.includes(r)||(t[r]=e[r]),t}),a())),this},missing:function(e,t){var r=this.value,n=c.getIterator(r),u=c.getIterator(e);return t(n.reduce((function(e,t){return u.includes(t)||(e[t]=r[t]),e}),a())),this},errorLog:function(e){return e(this._error),this},select:function(){return this._select=[],this},spread:function(e,t){var r,n=this;switch(e){case"value":case"values":r=n._select.reduce((function(e,t,r){return e["root/"+r]=n.value[t],e}),a());break;case"st":var u=n._select.reduce((function(e,t){return e[t]=n.value[t],e}),a());r=s.build(u);break;case"asJSON":var c=n._select.reduce((function(e,t){return e[t]=n.value[t],e}),{});r=JSON.stringify(c);break;case"toJSON":var o=n._select.reduce((function(e,t){return e[t]=n.value[t],e}),a());r=JSON.stringify(o.build());break;case"key":case"keys":r=n._select.reduce((function(e,t,r){return e["root/".concat(r)]=t.replace("root/",""),e}),a());break;case"dt":case"object":default:r=n._select.reduce((function(e,t){return e[t]=n.value[t],e}),a())}return t(r),n},spreadAll:function(e,t){return this.select().all().spread(e,t)},invert:function(){var e=this._select,t=c.getIterator(this.value);return this._select=t.reduce((function(t,r){return e.includes(r)||t.push(r),t}),[]),this},folder:function(e,t){var r;t=null==t?9999:t,t+=1,r=(e=e||"root").split("/").length+t;var n=c.getIterator(this.value).filter((function(t){return t.match(e)})).reduce((function(e,t){return t.split("/").length<=r&&e.push(t),e}),[]);return this._select=this._select.concat(n),this},parent:function(e,t){var r,n,u=this;n=u._select,u._select=[],u.folder(e);var o=u._select.reduce((function(e,t){var r=c.removeLast(t);return e.includes(r)||e.push(r),e}),[]);return t&&(o=o.reduce((function(e,r){u._select=[],u.folder(r,0);var n=u._select.reduce((function(e,t){var r=c.getUlt(t),n=u.value[t];return e[r]=n,e}),{});return t(n)&&e.push(r),e}),[])),r=o.reduce((function(e,t){return u._select=[],u.folder(t),e.concat(u._select)}),[]),u._select=n.concat(r),u},remove:function(e){var t=this;return void 0===e||(t._select=t._select.reduce((function(r,n){return e(t.value[n],n)||r.push(n),r}),[])),t},keep:function(e){var t=this;return void 0===e||(t._select=t._select.reduce((function(r,n){return e(t.value[n],n)&&r.push(n),r}),[])),t},limit:function(e){return this._select=this._select.slice(0,e),this},deep:function(e,t){var r,n=this._select.map((function(e){return e.split("/").length}));return t||(t="less"),"more"==t?(r=function(t){return n[t]>e},e+=1):(r=function(t){return n[t]<e},e+=3),this._select=this._select.reduce((function(e,t,n){return r(n)&&e.push(t),e}),[]),this},space:function(e){var t=this;null==e&&(e=["root"]),"string"==typeof e&&(e=[e]);var r=e.reduce((function(e,r){var n=t.namespace;return n.hasOwnProperty(r)&&(e=e.concat(n[r])),e}),[]);return 0==!r.length&&(t._select=t._select.concat(r)),t},block:function(e){return function(){var t,r=this,n=r.structure,u=r.value,o=c.getIterator(n),a=c.getIterator(u),i=e,s=f._reorder(o).reduce((function(e,t){var r=!1;return n[t]==i&&(r=e.every((function(e){return!e.includes(t)}))),r&&e.push(t),e}),[]);return 0==!(t=a.reduce((function(e,t){var r=!s.every((function(e){return!t.includes(e)}));if(r){var n=!1;s.forEach((function(e){if(!n&&t.includes(e)){var u=e.split("/").length+1,c=t.split("/").length;r=c==u,n=!0}}))}return r&&e.push(t),e}),[])).length&&(r._select=r._select.concat(t)),r}}},s={map:function(e){var t=this;return t.keyList().reduce((function(r,n,u){var c=e(n,u);return"string"!=typeof c&&(c=n),0!=c.indexOf("root/")&&(c="root/".concat(c)),r[c]=t[n],r}),a())},assemble:function(){var e,t,r=this,n=c.getIterator(r);return 0==n.length?r:(e=n.map((function(e){return e.split("/")})).map((function(e){return e.shift(),e})),e=f._reorder(e),t=e.map((function(e){return r["root/"+e.join("/")]})),e=f._removeDuplicates(e),(e=f._ignore(e)).forEach((function(e){return e.unshift("root")})),(e=e.map((function(e){return e.join("/")}))).reduce((function(e,r,n){return e[r]=t[n],e}),a()))},keyList:function(){return Object.getOwnPropertyNames(this)},valueList:function(){var e=this;return Object.getOwnPropertyNames(this).map((function(t){return e[t]}))},ignoreKeys:function(e){var t=this,r=t.keyList(),n=(e||0)+1,u=[],c=a();return r.forEach((function(e){var r=e.split("/"),o=r[n];u.includes(o)||u.push(o),r[n]=u.length-1,c[r.join("/")]=t[e]})),c},cut:function(e){if("number"!=typeof e)return this;return this.modifyKeys((function(t){return"root/".concat(function e(t,r){var n=t.indexOf("/");return-1==n?r=0:r--,r<1?t.substring(n+1):e(t.substring(n+1),r)}(t,e+1))}))},modifyKeys:function(e){var t=this;return c.getIterator(t).reduce((function(r,n,u){var c=t[n];return r[e(n)]=c,r}),a())},keepKeys:function(e){var t=this;return"function"!=typeof e?t:Object.getOwnPropertyNames(t).reduce((function(r,n){var u=n.split("/");return e(u)&&(r[n]=t[n]),r}),a())},removeKeys:function(e){var t=this;return"function"!=typeof e?t:Object.getOwnPropertyNames(t).reduce((function(r,n){var u=n.split("/");return e(u)||(r[n]=t[n]),r}),a())},keepValues:function(e){var t=this;return"function"!=typeof e?t:t.keyList().reduce((function(r,n){return e(t[n])&&(r[n]=t[n]),r}),a())},removeValues:function(e){var t=this;return"function"!=typeof e?t:t.keyList().reduce((function(r,n){return e(t[n])||(r[n]=t[n]),r}),a())},json:function(){return JSON.stringify(this)},file:function(){var e=this;return e.keyList().reduce((function(t,r){var n=r.split("/").reduce((function(e,t){return"root"==t?e:isNaN(parseInt(t))?e+"/".concat(t):e}),"root");return t.push("".concat(n,"/").concat(e[r])),t}),[])},keyValue:function(e){var t=this,r=e||"",n=(t.keyList(),t.keyList());return n.map((function(e,r){return"".concat(e," ").concat(t[n[r]])})).join("".concat(r," "))+r},list:function(){var e=this,t=c.getIterator(e),r=0,n=t.reduce((function(e,t){var n=c.removeLast(t);return null==e[n]&&(e[n]=r++),e}),{});return t.reduce((function(t,r){var u=c.removeLast(r),o=c.getUlt(r);return t["root/".concat(n[u],"/").concat(o)]=e[r],t}),a())},build:function(e){return e||(e=this),f._build(e)}},f={_build:function(e){var t=Object.keys(e).map((function(e){return e.split("/")})),r={},n=[],u=[];return t.forEach((function(e){var t=e[0];n.includes(t)||n.push(t)})),t.forEach((function(e){u.includes(e[0])||u.push(e[0])})),!isNaN(u[0])&&(r=[]),n.forEach((function(n){var u=[],c=t.reduce((function(e,t){return t[0]!=n||e.includes(t[1])||e.push(t[1]),e}),[]);c.every((function(e){var t=parseInt(e);isNaN(t)&&(u={})})),r=c.reduce((function(r,u){var c="".concat(n,"/").concat(u),o=new RegExp("^".concat(c,"/")),a=e[c],i="boolean"==typeof a||null!=a,s=t.reduce((function(t,r){return 2==r.length||null==r.join("/").match(o)||(t[r.slice(1).join("/")]=e[r.join("/")]),t}),{});return r[u]=i?a:f._build(s),r}),u)})),r},_toFolderFile:function(e){var t=[],r=[],n=[];return e.forEach((function(e){var u=e.split("/").pop(),c=e.replace("/".concat(u),"");t.forEach((function(e){c.includes(e)&&!r.includes(e)&&(r.push(e),n.push(0))})),t.includes(c)||t.push(c)})),e.reduce((function(e,t){var u=t.split("/").pop(),c=t.replace("/".concat(u),""),o=r.findIndex((function(e){return e==c}));return o>-1?e["".concat(c,"/").concat(n[o]++)]=u:e[c]=u,e}),a())},_scan:function(e){var t=e.target,r=e.namespace,n=e.dt;return c.getIterator(t).reduce((function(e,u){var o=c.notObject(t[u]),a="".concat(r,"/").concat(u);if(o){n.value[a]=t[u];var i=c.getUlt(r);return n.namespace[i].push(a),e}n.structure[a]=c.folderKind(t[u]),n.namespace.hasOwnProperty(u)||(n.namespace[u]=[]);var s={target:t[u],namespace:a,dt:n};return e.push(s),e}),[])},_transform:function(e,t){var r,n=e.value;switch(t){case"reverse":r=n.keyList().reduce((function(t,r){return t[e.value[r]]=r,t}),{});break;case"key":case"keys":var u=n.keyList().reduce((function(e,t){return e[t]=t.replace("root/",""),e}),{});r=s.build(u);break;case"value":case"values":var o=f._toFolderFile(n.valueList().map((function(e){return"root/".concat(e)}))),a=c.getIterator(o).reduce((function(e,t){var r=o[t];return e[!isNaN(parseInt(r))?"".concat(t,"/0"):"".concat(t,"/").concat(r)]=r,e}),{});r=s.build(a);break;case"file":case"files":case"folders":case"folder":r=f._toFolderFile(n.valueList().map((function(e){return"root/".concat(e)}))).build();break;default:r={}}return e=i.scan(r)},_removeDuplicates:function(e){var t,r;return 1==e[0].length||(t=e.map((function(e){return e[0]})),r=t[0],t.every((function(e){return e==r}))&&(e.forEach((function(e){return e.shift()})),f._removeDuplicates(e))),e},_reorder:function(e,t){var r=[];t=t||0;var n=e.reduce((function(e,t){return t.length>e?t.length:e}),0);return t>n?e:(e.reduce((function(e,r){return r.length-1==t?e:r[t]?(e.every((function(e){return e!=r[t]}))&&e.push(r[t]),e):e}),[]).forEach((function(n){e.forEach((function(e){e[t]==n&&r.push(e)}))})),e.forEach((function(e){r.every((function(t){return t!=e}))&&r.push(e)})),t++,f._reorder(r,t))},_ignore:function(e){var t,r,n,u=0;return e=c.copy(e),r=e.map((function(e){return e.pop()})),t=(t=e.map((function(e){if(0==e.length)return e;var t=e.join("");return isNaN(t)?[e.join("_")]:[e.join("")]}))).map((function(e,t){return e.concat(r[t])})),n=t[0][0],t=t.map((function(e){return e[0]!=n&&(n=e[0],u++),isNaN(e[0])||(e[0]=u),e}))}};u={assemble:s.assemble,ignoreKeys:s.ignoreKeys,cut:s.cut,keyList:s.keyList,valueList:s.valueList,list:s.list,map:s.map,json:s.json,file:s.file,keyValue:s.keyValue,build:s.build,modifyKeys:s.modifyKeys,keepKeys:s.keepKeys,removeKeys:s.removeKeys,keepValues:s.keepValues,removeValues:s.removeValues},n={init:i.init,load:i.load,loadFast:i.loadFast,preprocess:i.preprocess,add:i.add,update:i.update,insert:i.insert,overwrite:i.overwrite,spread:i.spread,spreadAll:i.spreadAll,log:i.errorLog,empty:function(){return Object.create(u)},identical:i.identical,change:i.change,same:i.same,different:i.different,missing:i.missing,select:i.select,parent:i.parent,folder:i.folder,all:i.folder,space:i.space,deepArray:i.block("array"),deepObject:i.block("object"),invert:i.invert,limit:i.limit,keep:i.keep,remove:i.remove,deep:i.deep},e.exports=n},function(e,t,r){"use strict";var n={notObject:function(e){var t=!1;return null==e&&(t=!0),"string"==typeof e&&(t=!0),"number"==typeof e&&(t=!0),"boolean"==typeof e&&(t=!0),"function"==typeof e&&(t=!0),t},isObject:function(e){return!n.notObject(e)},copy:function(e){return JSON.parse(JSON.stringify(e))},folderKind:function(e){return e instanceof Array?"array":"object"},getIterator:function(e){return Object.keys(e)},removeLast:function(e){var t=e.split("/");return t.pop(),t.join("/")},getPenult:function(e){var t=e.split("/");return t.pop(),t.pop()},getUlt:function(e){return e.split("/").pop()}};e.exports=n}])}));